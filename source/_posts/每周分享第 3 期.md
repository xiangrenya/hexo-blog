---
layout: post
title:  "每周分享第 3 期"
date:   2019-4-31
categories: 前端
tags: 学习
comments: true
---

## 可视化接口管理

背景：公司的接口文档都放在 wiki 平台上，时间长了，难以维护，同时没有一定的规范，后端的 swagger 代码生成的文档，缺乏灵活性，可读性也较差，前端开发人员不能直接更改接口文档，只能后端开发修改代码部署后才能看到 swagger 中最新的文档。

我们公司很多项目都是由前端来定义接口，前端其实是接口的消费者，根据产品设计的需要，主导制定接口文档，当然后端人员也是需要一起参与的，把关接口定义的合理性，约定好规范，才能正式开发。

由于新启动了一个项目，前期准备的时候，我在公司的阿里云服务器上部署了一个开源的可视化接口管理平台 YApi，对于制定接口文档，及时更新维护，还能模拟数据，自动化测试，真的是十分方便。

YApi：旨在为开发、产品、测试人员提供更优雅的接口管理服务。可以帮助开发者轻松创建、发布、维护 API。

特点：

- 权限管理
- 可视化接口管理
- Mock Server
- 自动化测试
- 数据导入
- 插件机制

![yapi-flow](/assets/images/201904/yapi-flow.jpg)

## REST API

REST 全称 Representational State Transfer（表现层状态转换），是 Roy Thomas Fielding 博士于 2000 年在他的博士论文中提出来的一种软件构建风格。

我们先来看两个不好的接口设计

```
/getAllcustomers
/createCustomer
/updateCustomer
/deleteCustomer
```

符合 REST 风格的接口，应该遵循 url 表示资源的定位，http method 请求方式表示对资源的操作，请求响应的状态码，表示请求的结果。

下面我们来举个简单的示例

客户列表
`GET /customers`
状态码: 201

过滤选项，可以通过 query 参数，追加在地址后面，如：`/customers?userName=allen&orderBy=createTime&sortBy=desc&pageNum=1&pageSize=10`

创建客户
`POST /customers`
状态码: 201

单个客户详情
`GET /customers/:customerId`
状态码: 200

更新客户
`PUT /customers/:customerId`
状态码: 200

删除客户
`DELETE /customers/:customerId`
状态码: 204

多级资源：获取某个客户下的所有订单
`/customers/:customerId/orders`

其它注意事项

- 使用 - 来分割单词让 url 可读性更好
- 使用 ? 用来过滤资源
- 避免使用多级 url
```
/customers/:customerId/orders/:orderId // Avoid
/orders/:orderId // Good
```

## 异地组网

买台昂贵的阿里云服务器，来做开发试验，有点太浪费了，家里正好有一台大部分时间处于闲置的 Lenovo G480 笔记本，拿它来做家用服务器。目前这台笔记本在原有的 windows 7 系统的基础上，额外安装了 centos 7 系统，实现了双系统，因为这台笔记本偶尔会被使用到，所以才保留了 windows 7 系统。

为了能够实现远程访问家里的服务器，我买了最低版本的蒲公英路由器：蒲公英X1，如图：

![pgyx1](/assets/images/201904/pgyx1.jpg)

功能一：远程访问家用服务器

通过访问：https://pgybox.oray.com/ 。进入蒲公英云管理后台，进行配置。

![pgy-router](/assets/images/201904/pgy-router.jpg)

同时，我们需要在电脑端或手机端安装蒲公英 vpn，现支持 linux、mac、windows、android、ios等，安装完，启动 vpn 即可，就可以实现网络内成员远程互相访问。

因为我现在使用的标准版，最多只能组网 3 个成员。现在我配置的 3 个成员是：蒲公英路由器，家用服务器，客户端VPN。

由于标准版组网成员数的限制，以及一个成员账号一次只能登陆一个设备，但是不同时间段，可以在不同设备上使用。所以我配置了客户端VPN这个成员账号，专门用来连接访问，用于办公笔记本、移动端等等，都可以连接家用服务器，但是要错开时间段使用。

![pgy-member](/assets/images/201904/pgy-member.jpg)

功能二：外接移动硬盘，实现资源共享

在蒲公英想 X1 预留了一个 USB 接口，可以外接移动硬盘，资源共享。

在 ios 系统为例，可以下载 sPlayer 软件，找到附近的资源入口，通过 Samba 协议，访问蒲公英路由器外接的移动硬盘中的资源。



## 参考资料

- [Yapi官网](https://yapi.ymfe.org/)
- [API design](https://docs.microsoft.com/en-us/azure/architecture/best-practices/api-design)
- [蒲公英客服中心](http://service.oray.com/category/pgy.html)
- [蒲公英VPN客户端 for Linux使用帮助](http://service.oray.com/question/5063.html)