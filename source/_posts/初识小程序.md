---
layout: post
title:  初识小程序
date:   2018-1-11
categories: 前端
tags: 小程序
---

当我们打开微信，发现大家都在玩小游戏跳一跳竞技排名的时候；当我们发现微信首屏下拉出现小程序列表的时候；当我们在饭店吃饭时，扫码小程序后可以看到座位号，并且能够快速支付的时候，我感觉小程序这次真的来了，是属于微信的小程序，将来一定是要取代微信公众号网页的，因为小程序的体验，已经很接近原生应用了。

## 小程序的未来

微信是移动互联网时代的船票，秉承连接一切的理念，为用户提供更加便利的服务，真正做到用完即走。大量的第三方服务跟微信对接，如城市服务，生活缴费，电商出行等等都有相关的公众号网页开发，微信成了这些提供服务的窗口，简单高效。毕竟，开发和运营原生应用的投入还是挺大的，而且也不能借助微信的流量入口，直接跟用户建立起深度联系。

虽然现在单页面应用框架很流行，但是H5的体验还是达不到原生的高度，小程序的出现大大弥补这一点。微信小程序的用户体验逼近原生应用，有强大的微信生态背景，无论是基于位置的服务，还是移动支付，消息推送，都是很方便企业服务的接入。所以小程序的的未来，应该是很有前景的，而且不可估量。

## 问题

在小程序的开发过程中，腾讯不提供远程连接服务器的功能，所以在开发环境和正式环境中，如果程序没有达到预期效果，那么就无法及时定位问题。譬如，我在基于node启动模板的项目中，写了个新增朋友圈动态的接口，但是在请求该接口的时候，无论是开发环境还是正式环境，都报出了502 Bad Gateway的错误，微信里的后端单点调试功能相当于鸡肋，几乎没有什么作用，后来我在小程序的反馈群里，咨询了一下，无果而终，毕竟咱不能上服务器上一看究竟，搞不好node服务已经挂了。

## 购买云服务器

小程序的开发离不开腾讯云的服务，从云服务器、云数据库、域名管理等等，给予开发者带来了极大的方便。所以决定买一个腾讯云服务器，并且能获得一个属于自己的公网IP，然后将自己的域名xiangry.cn解析到该IP地址。

云服务器新购特惠，下面我购买的云服务配置：

![image](/assets/images/qcloud-buy.jpg)

域名记得要实名认证，还要网站备案，这样才能在小程序的设置里绑定自己的request和socket的合法域名。

## 安装环境

腾讯云里面有个开发者实验室，其有一些不错的实验项目，而且还可以登上自己的云服务器，按照教程，做相应实验。关于小程序的开发环境的安装和配置，官方都提供了相关的实验：基于 [CentOS 搭建微信小程序服务](https://cloud.tencent.com/developer/labs/lab/10004)，提供了全方位的实践教程，安装node、mongodb、nginx的过程，如丝般顺滑，同时该实验以提供了一些node开发的基本流程。

CentOS 7.3里包管理工具里，默认的数据库是mariadb数据库，不能直接通过yum命令直接安装mysql数据库。如果要安装mysql数据库，建议参照这篇文章：[How to Install MySQL on CentOS 7](https://linode.com/docs/databases/mysql/how-to-install-mysql-on-centos-7/)，教程讲的很详细，可以少走弯路。

为了方便在本地管理数据库，我们必须实现远程登录mysql数据库。我们先通过ssh命令登录云服务器，然后通过mysql命令登录数据库，给数据库添加远程IP访问的权限。

``` bash
// 登录服务器
ssh -l root -p 22 [ip]
// 登录mysql数据库
mysql -u root -p
// 给远程访问的IP添加权限，并设置用户名和密码
// 第一*表示任意数据库，第二个*表示任意表，%代表允许任意ip登录，如果你想指定特定的IP，可以把%替换成指定的IP
// username和password是用来远程登录的账号和密码，可以自己设置
grant all privileges on *.* to 'username'@'%' identified by 'password'
// 让权限立即生效
flush privileges
// 在本地远程连接测试
mysql -h [ip] -P 3306 -u username -p
```

记得把[ip] 替换成自己的云服务器公网IP。

完成上述操作，就可以通过Navicat for MySQL客户端远程连接到云服务器上运行的mysql数据库，可以很方便在本地设计和管理数据库，而不用每次都要登录服务器。

![image](/assets/images/navicat.jpg)

已安装的软件及其版本：

- node v8.9.4
- mongodb v2.6.12
- mysql v5.6.38
- nginx v1.12.2

## 小程序开发

微信小程序提供了专门的开发者工具，包含了小程序解决方案的方方面面，有腾讯云服务做支撑，开发者只需关注代码层面的需求，无需过多地了解服务器运维方面的知识，简化了开发流程，提高了开发的效率。

小程序开发首先要注册小程序账号，注册完会得到一个appId，小程序唯一的标识，后续可以通过这个appId，在个人的微信公众号里绑定小程序，然后在你的个人简介里就会展示出已关联的小程序。现在的小程序只能分享给朋友，暂不支持分享至朋友圈。

打开小程序开发者工具，选择以腾讯云nodejs启动模板来新建项目，这样可以使用腾讯云的服务以及js技术栈，在此基础上做相关的业务开发。

小程序开发提供了两种环境，一是开发环境，一是生产环境。主要的区别在于只有部署在生产环境的程序，才能发布到线上，提交审核。代码上传至开发环境会自动开通开发环境，开发环境的域名是以.la结尾的，而开通生产环境，首先需要开通域名，完成实名认证，授权ssl证书。上传至生产环境之前，需要修改跟环境相关的配置文件，如请求的域名，数据库的连接配置。生产环境部署完，就可以点击开发者工具里的上传按钮，上传完，就可以在小程序管理后台看到出现了一个开发版，可以提交审核。

## 参考资料

- [CentOS 搭建微信小程序服务](https://cloud.tencent.com/developer/labs/lab/10004)
- [How to Install MySQL on CentOS 7](https://linode.com/docs/databases/mysql/how-to-install-mysql-on-centos-7/)
